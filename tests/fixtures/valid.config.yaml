modules:
  - name: backend
    type: workspace
    path: ./apps/backend
    run:
      dev: npm run dev
      build: npm run build
      test: npm test
    dependsOn:
      - infra
    logs: ./tmp/backend.log
    env:
      NODE_ENV: development
      PORT: "3000"

  - name: frontend
    type: workspace
    path: ./apps/frontend
    run:
      dev: npm run dev
      build: npm run build
    dependsOn:
      - backend
    packageManager: npm

  - name: infra
    type: docker
    composeFile: ./docker-compose.dev.yaml
    services:
      - postgres
      - redis
      - traefik

  - name: worker
    type: custom
    command: node scripts/worker.js
    cwd: ./apps/backend
    dependsOn:
      - infra
